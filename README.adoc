= CPOA - TD
J.-M. Bruel <jbruel@gmail.com>
v20.1 {localdate}
:tdnum: TD3
:uk!:
:imagesdir: images
//------------------------- variables de configuration
// only used when master document
:icons: font
:experimental:
:numbered!:
:status:
:source-highlighter: rouge
:baseURL: http://bit.ly/jmb-cpoa
:github: https://github.com[GitHub]
// Specific to GitHub
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:

endif::[]
//------------------------------------ 
ifdef::uk[]
:lang: uk
:lastName: LAST NAME
:firstName: First Name
:group: Group
:example: Example
:Enseignants: Teachers
:principe: Good design principle
:assignment: Assignment info
:requirements: Requirements
:initial: Initial tasks
:allerPlusLoin: Still hungry?...
:about: About...
:contrib: Contributors
:translation: Translations
endif::[]
ifndef::uk[]
:lang: fr
:lastName: NOM
:firstName: Prénom
:group: Groupe
:example: Exemple
:Enseignants: Enseignants
:principe: Principe Objet
:assignment: Informations générales
:requirements: Pré-requis
:initial: Tâche initiale
:allerPlusLoin: Pour Aller plus loin...
:about: À propos...
:contrib: Contributeurs
:translation: Traductions
endif::[]
:java: https://www.java.com/fr/[Java]
:asciidoc: http://www.methods.co.nz/asciidoc[AsciiDoc]indexterm:[AsciiDoc]
:asciidoctorlink: http://asciidoctor.org/[Asciidoctor]indexterm:[Asciidoctor]
//------------------------------------ 

ifdef::uk[]
== {tdnum} initial code
This is a template for the students' assignments.

ifndef::backend-pdf[]
TIP: Course material: pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] {baseURL}
endif::[]

ifdef::backend-pdf[]
TIP: Course material: icon:mobile[] icon:tablet[] icon:laptop[] {baseURL}
endif::[]
endif::[]

ifndef::uk[]
== Code initial pour le {tdnum}

ifndef::backend-pdf[]
TIP: Rappel du cours : pass:[<i class="fa fa-mobile"></i> <i class="fa fa-tablet"></i> <i class="fa fa-laptop"></i>] {baseURL}
endif::[]

ifdef::backend-pdf[]
TIP: Rappel du cours : icon:mobile[] icon:tablet[] icon:laptop[] {baseURL}
endif::[]

endif::[]

//------------------------------------ 
== {assignment}

{lastName}:: BRUEL

{firstName}:: Jean-Michel

{group} #::

[%interactive]
- [x] {Enseignants}
- [ ] 1
- [ ] 2
- [ ] 3
- [ ] 4
- [ ] Innopolis

//------------------------------------ 
== {requirements}

ifdef::uk[]
You'll need:

[%interactive]
* [x] A {Github} account  
* [ ] A https://gitforwindows.org/[Git Bash] terminal (if you use Window$)
endif::[]
ifndef::uk[]
Il vous faut :

[%interactive]
* [x] Un compte {Github}  
* [ ] Un terminal de type https://gitforwindows.org/[Git Bash]  (si vous utilisez Window$)
endif::[]

ifdef::uk[]
[TIP]
====    
Try the following command in your terminal to check your `git` environment:
endif::[]
ifndef::uk[]
[TIP]
====    
Essayez la commande suivante dans votre terminal pour vérifier votre environnement `git` :
endif::[]

[source,shell]
....
git config --global -l
....
====

//------------------------------------ 
== {initial}

ifdef::uk[]
[%interactive]
* [x] Click on the Github Classroom link provided by your teacher (in fact, this should be done if you read this).
* [ ] Clone on your machine the Github project generated by Github Classroom.  
* [ ] Modify the README file to add your last name, first name and group number. 
* [ ] Commit and push using the following message:
endif::[]
ifndef::uk[]
[%interactive]
* [x] Clickez sur le lien Github Classroom fourni par votre enseignant (en fait c'est déjà fait si vous lisez ces lignes).
* [ ] Clonez sur votre machine le projet Github généré pour vous par Github Classroom.  
* [ ] Modifez le `README` pour modifier Nom, Prénom et Groupe. 
* [ ] Commit & push:
endif::[]

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #0 Initial task done
....

[IMPORTANT]
ifndef::uk[]
Dans la suite de ce document, à chaque fois que vous trouverez un énoncé commençant par `fix #...` vous devez vérifier que vos scripts/fichiers modifiés sont bien dans votre dépôt local en vue de committer et de pusher les modifications sur votre dépôt distant en utilisant comme message de commit cet énoncé.

[TIP]
====
- Si vous voulez vérifier que vous êtes prêt pour le `fix #0`, utilisez la commande : `make check`.
- Si vous voulez avoir la liste des ToDos de ce TP/TP, exécutez `make todos`.
====

[NOTE]
=====
Les exercices de ce TD sont tirés de l'excellent livre "Tête la première : Design Pattern".
Bert Bates, Eric Freeman, Elisabeth Freeman, Kathy Sierra. Editions O'Reilly. 2005.

image::headFirst.jpg[link="https://www.oreilly.com/library/view/head-first-design/0596007124/",width=40%]
=====

endif::[]
ifdef::uk[]
In the following, every time you'll see à `fix #...` text, 
make sure all your files are committed, and then push your modifications in the distant repo, making sure you used the corresponding message (`fix #...`) in one of the `commit` messages.

[TIP]
====
- If you want to check that you're really ready for `fix #0`, you can run the command in your shell: `make check`.
- If you want to list the ToDos of the day, run `make todos`.
====

[NOTE]
=====
This TD exercise is inspired from the excellent https://www.oreilly.com/library/view/head-first-design/0596007124/[book]: "Head First: Design Pattern.
Bert Bates, Eric Freeman, Elisabeth Freeman, Kathy Sierra. Editions O'Reilly. 2005."

image::headFirst.jpg[link="https://www.oreilly.com/library/view/head-first-design/0596007124/",width=40%]
=====
endif::[]

//------------------------------------ 
//------------------------------------ 
//------------------------------------ 
//------------  Let's START----------- 
//------------------------------------ 
//------------------------------------ 

:numbered:
//------------------------------------ 
== La pizzeria O'Reilly

Vous êtes embauché dans une pizzeria pour faire ... de l'informatique
(il y en a bien qui font leur PTUT pour une boulangerie...)!

Le stagiaire de l'an dernier qui avait travaillé sur le code est parti avec
la caisse (de Chianti). Vous n'avez à votre disposition que :

- Le code de départ suivant :
+
.`Pizzeria.java` code initial (source disponible dans `src`)
[source,java]
------	
include::src/main/java/Pizzeria.java[]
------
+
- L'ébauche de diagramme de classe des pizzas suivant :
+
image::Pizzas.svg[width=70%, scaledwidth=70%, align=center]
+
- Le bout de code de test suivant :
+
[source, java]
------
Pizzeria boutiqueBrest = new Pizzeria ();
boutiqueBrest.commanderPizza ("fromage");
...
Pizzeria boutiqueStrasbourg = new Pizzeria ();
boutiqueStrasbourg.commanderPizza ("grecque");
------

// ----------------------------- Question ------------------
.*TODO*:
[WARNING]
====
[%interactive]
* [ ] Identifiez ce qui varie dans ce code (si la pression du marché fait
	ajouter des pizzas à la carte ou si une pizza n'a plus de succès et doit
	disparaître, etc.).
* [ ]  Isolez dans une classe `SimpleFabriqueDePizzas` ce code.
+
[TIP]
=====
- L'idée est de remplacer le `if` dans ce code par quelque chose comme `pizza = fabrique.creerPizza(type);`
- Bien sûr vous héritez de cet horrible "if then else" et dans
votre implémentation en TP vous remplacerez ce code avantageusement
par un "switch case" et utiliserez éventuellement un `enum`.
=====
+
* [ ]  Réalisez le diagramme de classe obtenu.
* [ ]  Quel est l’avantage de procéder ainsi ? Ne transfère-t'on pas
simplement le problème à un autre objet ?
+
ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #1.1 Simple Pizza Factory
....
+
====


== On y est presque...

=== Succès des pizzerias O'Reilly : les franchises

Plusieurs villes veulent ouvrir des pizzerias comme la vôtre.
Votre patron, très content de vos programmes souhaite imposer à toutes
les futures pizzerias d'utiliser vos codes.

Le problème : les pizzas au fromage de Strasbourg sont différentes
des pizzas aux fromages de Corse!


//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Proposez une solution où `SimpleFabriqueDePizzas` serait une
classe abstraite.
====

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #2.1 Use of abstract factories
....

Nous sommes arrivés à une situation propre, qui s'apparente à un patron de conception.

Souvent appelé _Simple Factory_, ou _Factory Method_, il n'est pas complètement considéré comme un patron :

[NOTE]
.(almost) Design pattern : *Simple Fabrique*
====
include::pattern/fabrique.txt[]
====

Mais avant d'en arriver à la définition
du patron lui-même, nous allons améliorer un peu les choses.

=== La dérive : chacun travaille comme il l'entend!

Les pizzerias utilisent bien vos fabriques mais ont changé
leurs procédures : certaines ne coupent pas les pizzas, changent les
temps de cuissons, et les pizzerias O'Reilly perdent leur
identité. Il nous faut donc *restructurer* les pizzerias.

Un consultant italien payé fort cher (heureusement en pizzas!)
propose de revenir à la structure suivante :

[source,java]
------
public abstract class Pizzeria {
	public final Pizza commanderPizza(String type) {
		Pizza pizza;

		pizza = creerPizza(type);
		pizza.preparer();
		pizza.cuire();
		pizza.couper();
		pizza.emballer();

		return pizza;
	}

	....... Pizza creerPizza(String type);
}
------

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Quelles sont les différences avec notre conception actuelle?
====

=== Laisser les sous-classes décider

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Dans le schéma suivant, placez les méthodes au bon endroit de
façon à ce que les procédures soient respectées tout en ayant des pizzas
à variantes "régionales".

image::Pizzeria3.svg[width=60%,scaledwidth=60%]
====

.*TIP*
TIP: Chaque sous-classe redéfinit la méthode `creerPizza()`,
tandis que toutes les sous-classes utilisent la méthode `commanderPizza()`
définie dans `Pizzeria`.



ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #2.3 Simple Pizza Factory
....


=== Déclarer une méthode de fabrique

Rien qu'en apportant une ou deux transformations à `Pizzeria`,
nous sommes passés d'un objet gérant l'instanciation de nos classes concrètes
à un ensemble de sous-classes qui assument maintenant cette responsabilité.

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Quelle est la déclaration exacte de la méthode `creerPizza()`
de la classe `Pizzeria` ?
====

=== Récapitulons

//----------------------------- Question ------------------
.*QUESTION*
[WARNING]
====
Donnez le diagramme de séquence d'une "commande de pizza au fromage
de type Strasbourg".
====

NOTE: Vous implémenterez les classes manquantes en TP.

ifndef::backend-pdf[.pass:[<i class="fa fa-github"></i>] commit/push]
ifdef::backend-pdf[.icon:github[] commit/push]
[source,shell]
....
fix #2.5 Simple Pizza Factory
....

== Le patron Fabrique

Nous y sommes, vous venez de décortiquer le patron Fabrique Simple

[[Fabrique]]
[NOTE]
.Design pattern : *Fabrique*
====
include::pattern/fabrique-abstraite.txt[]
====

ifndef::compact[]

.Several examples of Factory pattern definitions
image::google-fabrique.png[link="images/google-fabrique.png",width=100%,scaledwidth=100%]

//------------------------------------ 
== Ressources
//------------------------------------ 

Mise en place de l'environnement Eclipse:

- Créez un nouveau répertoire (disons `{tdnum}`)
- Dans ce dossier ouvrez un git bash
- git clone http://urlduprojet
- Ouvrez eclipse, changez de workspace, sélectionnez le dossier `{tdnum}`
- Une fois le workspace ouvert, cliquez sur menu:File[Import > General > Projects from Folder or Achive] puis `Next`
- menu:Select root directory[Browse], sélectionnez ce repo (`urlduprojet` dans cet example)
- Cliquez sur menu:Finish[]

Installation de Maven sous Windows:

- Télécharger: https://apache.mediamirrors.org/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.zip
- Décompresser le contenu dans `C:\Programmes\Java`
- Dans Menu Démarrer, taper `Environnement` puis cliquer sur menu:Modifier les variables d'environnement système[]
- Cliquer sur `Variables d'environnement`
- Dans la section `Variables système`, sélectionner `Path`, cliquer sur `Modifier`
- Cliquez sur `Nouveau`, puis saisissez `C:\Program Files\Java\apache-maven-3.6.3\bin` (vérifiez que le dossier existe)
- Cliquez successivement 3 fois sur "OK".
- La commande MVM devrait être disponible dans un cmd windows (fermer les existants)

//------------------------------------ 
== {translation}
//------------------------------------ 

.Translations French/English/Russian of the code vocabulary
[options="header,footer"]
|===============================================
| FR 					|  US     			| RU
| Grecque     			|  Greek       		| ??
| Fromage       		|  Cheese   		| ??
| Poivron     			|  Pepper   		| ??
| preparer     			|  prepare   		| ??
| cuire     			|  bake        		| ??
| couper     			|  cut         		| ??
| emballer     			|  wrap        		| ??
| creer      			|  create   		| ??
| commander    			|  order       		| ??
|===============================================

//------------------------------------ 
== {contrib}
//------------------------------------ 

- mailto:jbruel@gmail.com[Jean-Michel Bruel]

== {about}

****************************************************************
Baked with {asciidoctorlink} (version `{asciidoctor-version}`) from 'Dan Allen', based on {asciidoc}.
'Licence Creative Commons'.
image:88x31.png["Licence Creative
Commons",style="border-width:0",link="http://creativecommons.org/licenses/by-sa/3.0/"]
http://creativecommons.org/licenses/by-sa/3.0/[licence Creative Commons Paternité - Partage à l&#39;Identique 3.0 non transposé].
****************************************************************
endif::compact[]
